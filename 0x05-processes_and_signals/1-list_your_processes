#!/usr/bin/env bash
# Function to display processes in a hierarchical format

print_tree() {
    local parent_pid=$1
    local indent=$2

    # Get all child processes of the parent PID
    local children
    children=$(ps -eo pid,ppid,user,%cpu,%mem,vsz,rss,tty,stat,start,time,cmd --no-headers | awk -v ppid="$parent_pid" '$2==ppid {print $0}')

    while IFS= read -r line; do
        # Extract PID and CMD
        pid=$(echo "$line" | awk '{print $1}')
        cmd=$(echo "$line" | awk '{for(i=12;i<=NF;i++) printf $i " "; print ""}')

        # Print with indentation
        echo "${indent}${line/$pid/$pid}"  

        # Recurse into child processes
        print_tree "$pid" "   $indent"
    done <<< "$children"
}

# Print header
echo "USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND"

# Start with all root-level processes (PPID=0)
root_processes=$(ps -eo pid,ppid,user,%cpu,%mem,vsz,rss,tty,stat,start,time,cmd --no-headers | awk '$2==0')

while IFS= read -r line; do
    pid=$(echo "$line" | awk '{print $1}')
    echo "$line"
    print_tree "$pid" "   "
done <<< "$root_processes"
