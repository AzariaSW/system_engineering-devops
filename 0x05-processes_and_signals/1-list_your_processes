#!/usr/bin/env bash
# Function to display processes in a hierarchical format

display_process_tree_custom() {
    # Print the header exactly as specified
    printf "%-8s %-9s %s\n" "USER" "STARTED" "COMMAND"
    
    # Get all processes with tree structure and format
    # Using lstart for full timestamp including seconds
    ps -e -o user:8,lstart,comm --forest --no-headers | while read -r line; do
        # Remove extra spaces
        line=$(echo "$line" | sed 's/^ *//')
        
        # Check if line starts with tree characters
        if [[ "$line" =~ ^[|\\_ ]*[A-Za-z] ]]; then
            # This is a child process with tree characters
            # Extract tree characters and the rest
            tree_part=$(echo "$line" | grep -o '^[|\\_ ]*')
            rest=$(echo "$line" | sed 's/^[|\\_ ]*//')
            
            # Extract components from rest
            user=$(echo "$rest" | awk '{print $1}')
            start_time=$(echo "$rest" | grep -oE '[0-9]{2}:[0-9]{2}:[0-9]{2}' | head -1)
            command=$(echo "$rest" | sed 's/^[^ ]* //' | sed 's/.*[0-9]\{4\} //')
            
            # Format with tree characters
            printf "%s%-8s %-9s %s\n" "$tree_part" "$user" "$start_time" "$command"
        else
            # This is a root process
            user=$(echo "$line" | awk '{print $1}')
            start_time=$(echo "$line" | grep -oE '[0-9]{2}:[0-9]{2}:[0-9]{2}' | head -1)
            command=$(echo "$line" | sed 's/^[^ ]* //' | sed 's/.*[0-9]\{4\} //')
            
            printf "%-8s %-9s %s\n" "$user" "$start_time" "$command"
        fi
    done
}

# Main execution
display_process_tree_custom
